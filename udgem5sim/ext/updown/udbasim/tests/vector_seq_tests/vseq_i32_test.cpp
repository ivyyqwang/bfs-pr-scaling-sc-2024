#include <gtest/gtest.h>
#include "udlane.hh"
#include "types.hh"
#include "lanetypes.hh"
#include "udaccelerator.hh"
#include <cmath>
#include <cfenv>

using namespace basim;

class Vseq_i32Test : public ::testing::Test {
 protected:
    size_t num_threads = 2;
    int num_lanes = 64;
    UDAccelerator acc0 = UDAccelerator(num_lanes, 0, 0);
    int buffsize1 = 1024;
    int buffsize2 = 1024;
};
static inline float BF16ToFloat(uint16_t var) {
    uint32_t var32 = static_cast<uint32_t>(var) << 16;
    return *reinterpret_cast<float *>(&var32);
}
TEST_F(Vseq_i32Test, vseq_i32_0){
    acc0.initSetup(0,"testprogs/binaries/vseq_i32_0.bin", 0);
    uint8_t numop = 2;
    eventword_t ev0(0);
    ev0.setNumOperands(numop);
    operands_t op0(numop);
    word_t* data = new word_t[numop];
    for(auto i = 0; i < numop; i++)
        data[i] = i+5;
    op0.setData(data);
    eventoperands_t eops(&ev0, &op0);
    acc0.pushEventOperands(eops, 0);
    acc0.pushEventOperands(eops, 1);
    while(!acc0.isIdle())
        acc0.simulate(2);
    int mask;
    uint32_t w0_0 = 1244807668, w0_1 = -877365653;
    int val0_0 = *reinterpret_cast<int*>(&w0_0), val0_1 = *reinterpret_cast<int*>(&w0_1);
    uint32_t w1_0 = 666858107, w1_1 = -1514287640;
    int val1_0 = *reinterpret_cast<int*>(&w1_0), val1_1 = *reinterpret_cast<int*>(&w1_1);
    uint32_t w2_0 = 1073758867, w2_1 = -1463697016;
    int val2_0 = *reinterpret_cast<int*>(&w2_0), val2_1 = *reinterpret_cast<int*>(&w2_1);
    uint32_t w3_0 = 660463312, w3_1 = 1283290526;
    int val3_0 = *reinterpret_cast<int*>(&w3_0), val3_1 = *reinterpret_cast<int*>(&w3_1);
    uint32_t w4_0 = -660312832, w4_1 = -1412264877;
    int val4_0 = *reinterpret_cast<int*>(&w4_0), val4_1 = *reinterpret_cast<int*>(&w4_1);
    uint32_t w5_0 = -931911105, w5_1 = 860536278;
    int val5_0 = *reinterpret_cast<int*>(&w5_0), val5_1 = *reinterpret_cast<int*>(&w5_1);
    uint32_t w6_0 = 718113248, w6_1 = 351600421;
    int val6_0 = *reinterpret_cast<int*>(&w6_0), val6_1 = *reinterpret_cast<int*>(&w6_1);
    uint32_t w7_0 = 1121482075, w7_1 = 815478515;
    int val7_0 = *reinterpret_cast<int*>(&w7_0), val7_1 = *reinterpret_cast<int*>(&w7_1);
    uint32_t *val0_0_cast = reinterpret_cast<uint32_t*>(&val0_0);
    uint32_t *val1_0_cast = reinterpret_cast<uint32_t*>(&val1_0);
    uint32_t *val2_0_cast = reinterpret_cast<uint32_t*>(&val2_0);
    uint32_t *val3_0_cast = reinterpret_cast<uint32_t*>(&val3_0);
    uint32_t *val4_0_cast = reinterpret_cast<uint32_t*>(&val4_0);
    uint32_t *val5_0_cast = reinterpret_cast<uint32_t*>(&val5_0);
    uint32_t *val6_0_cast = reinterpret_cast<uint32_t*>(&val6_0);
    uint32_t *val7_0_cast = reinterpret_cast<uint32_t*>(&val7_0);
    uint32_t result = 0;
    mask = 2;
    val3_0 = (mask >> 0 & 1) ? val2_0 * val3_0 + val3_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val2_1 * val3_1 + val3_1 : val3_1;
    mask = 1;
    val5_0 = (mask >> 0 & 1) ? val6_0 * val3_0 : val5_0;
    val5_1 = (mask >> 1 & 1) ? val6_1 * val3_1 : val5_1;
    mask = 3;
    val4_0 = (mask >> 0 & 1) ? val1_0 - val3_0 : val4_0;
    val4_1 = (mask >> 1 & 1) ? val1_1 - val3_1 : val4_1;
    mask = 3;
    val4_0 = -424;
    val4_1 = -424;
    mask = 1;
    val6_0 = -1870;
    val6_1 = -1870;
    mask = 3;
    val1_0 = (mask >> 0 & 1) ? val4_0 + val7_0 : val1_0;
    val1_1 = (mask >> 1 & 1) ? val4_1 + val7_1 : val1_1;
    mask = 3;
    val2_0 = (mask >> 0 & 1) ? val6_0 + val2_0 : val2_0;
    val2_1 = (mask >> 1 & 1) ? val6_1 + val2_1 : val2_1;
    mask = 3;
    val3_0 = (mask >> 0 & 1) ? val1_0 * val7_0 + val3_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val1_1 * val7_1 + val3_1 : val3_1;
    mask = 3;
    val3_0 = (mask >> 0 & 1) ? val3_0 * val6_0 + val3_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val3_1 * val6_1 + val3_1 : val3_1;
    mask = 1;
    val3_0 = -199;
    val3_1 = -199;
    mask = 3;
    val7_0 = -1342;
    val7_1 = -1342;
    mask = 1;
    val2_0 = (mask >> 0 & 1) ? val5_0 + val1_0 : val2_0;
    val2_1 = (mask >> 1 & 1) ? val5_1 + val1_1 : val2_1;
    mask = 3;
    val5_0 = (mask >> 0 & 1) ? val6_0 + val3_0 : val5_0;
    val5_1 = (mask >> 1 & 1) ? val6_1 + val3_1 : val5_1;
    mask = 3;
    val5_0 = 948;
    val5_1 = 948;
    mask = 3;
    val3_0 = (mask >> 0 & 1) ? val5_0 * val5_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val5_1 * val5_1 : val3_1;
    mask = 1;
    val2_0 = 1685;
    val2_1 = 1685;
    mask = 3;
    val2_0 = (mask >> 0 & 1) ? val1_0 * val7_0 + val2_0 : val2_0;
    val2_1 = (mask >> 1 & 1) ? val1_1 * val7_1 + val2_1 : val2_1;
    mask = 2;
    val1_0 = (mask >> 0 & 1) ? val1_0 - val2_0 : val1_0;
    val1_1 = (mask >> 1 & 1) ? val1_1 - val2_1 : val1_1;
    mask = 2;
    val3_0 = (mask >> 0 & 1) ? val5_0 * val1_0 + val3_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val5_1 * val1_1 + val3_1 : val3_1;
    mask = 1;
    val1_0 = (mask >> 0 & 1) ? val4_0 - val4_0 : val1_0;
    val1_1 = (mask >> 1 & 1) ? val4_1 - val4_1 : val1_1;
    mask = 1;
    val3_0 = (mask >> 0 & 1) ? val4_0 - val1_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val4_1 - val1_1 : val3_1;
    mask = 3;
    val6_0 = (mask >> 0 & 1) ? val7_0 - val3_0 : val6_0;
    val6_1 = (mask >> 1 & 1) ? val7_1 - val3_1 : val6_1;
    mask = 1;
    val3_0 = 1821;
    val3_1 = 1821;
    mask = 2;
    val5_0 = (mask >> 0 & 1) ? val5_0 + val3_0 : val5_0;
    val5_1 = (mask >> 1 & 1) ? val5_1 + val3_1 : val5_1;
    mask = 2;
    val6_0 = (mask >> 0 & 1) ? val7_0 + val5_0 : val6_0;
    val6_1 = (mask >> 1 & 1) ? val7_1 + val5_1 : val6_1;
    mask = 3;
    val1_0 = 998;
    val1_1 = 998;
    mask = 2;
    val2_0 = (mask >> 0 & 1) ? val5_0 * val1_0 + val2_0 : val2_0;
    val2_1 = (mask >> 1 & 1) ? val5_1 * val1_1 + val2_1 : val2_1;
    mask = 1;
    val7_0 = (mask >> 0 & 1) ? val6_0 - val5_0 : val7_0;
    val7_1 = (mask >> 1 & 1) ? val6_1 - val5_1 : val7_1;
    mask = 1;
    val6_0 = (mask >> 0 & 1) ? val2_0 * val3_0 + val6_0 : val6_0;
    val6_1 = (mask >> 1 & 1) ? val2_1 * val3_1 + val6_1 : val6_1;
    mask = 1;
    val4_0 = (mask >> 0 & 1) ? val5_0 + val5_0 : val4_0;
    val4_1 = (mask >> 1 & 1) ? val5_1 + val5_1 : val4_1;
    mask = 2;
    val3_0 = (mask >> 0 & 1) ? val3_0 * val3_0 : val3_0;
    val3_1 = (mask >> 1 & 1) ? val3_1 * val3_1 : val3_1;
    mask = 1;
    val5_0 = -924;
    val5_1 = -924;
    mask = 3;
    val3_0 = 1323;
    val3_1 = 1323;
    mask = 2;
    val4_0 = -1805;
    val4_1 = -1805;
    mask = 2;
    val5_0 = (mask >> 0 & 1) ? val3_0 - val3_0 : val5_0;
    val5_1 = (mask >> 1 & 1) ? val3_1 - val3_1 : val5_1;
    mask = 1;
    val2_0 = (mask >> 0 & 1) ? val5_0 - val4_0 : val2_0;
    val2_1 = (mask >> 1 & 1) ? val5_1 - val4_1 : val2_1;
    mask = 1;
    val2_0 = (mask >> 0 & 1) ? val7_0 + val6_0 : val2_0;
    val2_1 = (mask >> 1 & 1) ? val7_1 + val6_1 : val2_1;
    mask = 1;
    val7_0 = (mask >> 0 & 1) ? val5_0 / val6_0 : val7_0;
    val7_1 = (mask >> 1 & 1) ? val5_1 / val6_1 : val7_1;
    mask = 2;
    val5_0 = (mask >> 0 & 1) ? sqrt(val3_0) : val5_0;
    val5_1 = (mask >> 1 & 1) ? sqrt(val3_1) : val5_1;
    mask = 1;
    result = 0;
    result |= (mask >> 0 & 1) & (val1_0 > val2_0);
    result |= (mask >> 1 & 1) & (val1_1 > val2_1);
    *val3_0_cast = (*val3_0_cast & ~mask) | result;
    uint64_t final_result_0 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val0_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val0_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X16, final_result_0));
    uint64_t final_result_1 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val1_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val1_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X17, final_result_1));
    uint64_t final_result_2 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val2_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val2_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X18, final_result_2));
    uint64_t final_result_3 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val3_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val3_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X19, final_result_3));
    uint64_t final_result_4 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val4_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val4_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X20, final_result_4));
    uint64_t final_result_5 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val5_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val5_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X21, final_result_5));
    uint64_t final_result_6 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val6_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val6_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X22, final_result_6));
    uint64_t final_result_7 = (uint64_t)(*reinterpret_cast<uint32_t*>(&val7_0)) | ((uint64_t)(*reinterpret_cast<uint32_t*>(&val7_1)) << 32);
    EXPECT_TRUE(acc0.testReg(0, RegId::X23, final_result_7));
}
